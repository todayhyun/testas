<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <!-- iOS  -->
   <meta name="apple-mobile-web-app-title" content="Application Title">
   <meta name="apple-mobile-web-app-capable" content="yes">
   <meta name="apple-mobile-web-app-status-bar-style" content="black">
 
  <link rel="shortcut icon" href="images/icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="images/icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/icons/favicon-32x32.png">

  <!-- iOS  -->
  <link href="images/icons/apple-touch-icon.png" rel="apple-touch-icon" type="image/png">
  <link href="images/icons/apple-touch-icon-76x76.png" rel="apple-touch-icon" type="image/png" sizes="76x76">
  <link href="images/icons/apple-touch-icon-120x120.png" rel="apple-touch-icon" type="image/png" sizes="120x120">
  <link href="images/icons/apple-touch-icon-152x152.png" rel="apple-touch-icon" type="image/png" sizes="152x152">

  <title> HELLO PWA  </title>

  <link rel="manifest" crossorigin="use-credentials" href="manifest.json">
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('./service_worker.js')
        .then(function () {
          console.log('ì„œë¹„ìŠ¤ ì›Œì»¤ê°€ ë“±ë¡ë¨!');
        })
    }
  </script>
  <style>
    .hidden {
        display: none !important;
    }
   </style>
   
</head>
<body>
  <h1>HELLO PWA</h1>
  <div id="installContainer" class="hidden" >
    <button id="butInstall" type="button">
      ì•±ìœ¼ë¡œ ì„¤ì¹˜
    </button>
  </div>
</body>
<script src="js/main.js"></script>

<script>
window.addEventListener('beforeinstallprompt', (event) => {
  console.log('ğŸ‘', 'beforeinstallprompt', event);
  // ë‚˜ì¤‘ì— ì´ë²¤íŠ¸ë¥¼ í™œì„±í™”í•˜ë ¤ê³  ë³´ê´€í•œë‹¤.
  window.deferredPrompt = event;
  // ì„¤ì¹˜ ë²„íŠ¼ì— ë‹´ê¸´ hidden í´ë˜ìŠ¤ë¥¼ ì œê±°í•œë‹¤. 
  divInstall.classList.toggle('hidden', false);
});

butInstall.addEventListener('click', async () => {
  console.log('ğŸ‘', 'butInstall-clicked');
  const promptEvent = window.deferredPrompt;
  if (!promptEvent) {
    // The deferred prompt isn't available.
    return;
  }
  // ì„¤ì¹˜ prompt í˜¸ì¶œ!
  promptEvent.prompt();
  // ê²°ê³¼ë¬¼ ë¡œê¹… ë° ì‚¬ìš©ì ì„ íƒ ì €ì¥
  const result = await promptEvent.userChoice;
  console.log('ğŸ‘', 'userChoice', result);
  // ì´ë²¤íŠ¸ ì´ˆê¸°í™”. prompt()ëŠ” í•œë²ˆë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.
  window.deferredPrompt = null;
  // ì„¤ì¹˜ ë²„íŠ¼ ë‹¤ì‹œ ìˆ¨ê¸°ê¸°
  divInstall.classList.toggle('hidden', true);

});

window.addEventListener('appinstalled', (event) => {
  console.log('ğŸ‘', 'appinstalled', event);
  // ì´ë²¤íŠ¸ ì´ˆê¸°í™” (ë¦¬ì†ŒìŠ¤ ê°€ë¹„ì§€ ì²˜ë¦¬) 
  window.deferredPrompt = null;
});

</script>

</html>